# 🔧 Manual SQL Migration Required

**Date**: August 13, 2025  
**Priority**: CRITICAL - Blocking workflow creation

## 📋 SQL to Execute in Supabase Dashboard

### Step 1: Access SQL Editor
Go to: https://supabase.com/dashboard/project/zfbgdixbzezpxllkoyfc/sql/new

### Step 2: Run This SQL

```sql
-- Add missing webhook_url column
ALTER TABLE mvp_workflows 
ADD COLUMN IF NOT EXISTS webhook_url TEXT;

-- Add missing sync columns (if not present)
ALTER TABLE mvp_workflows 
ADD COLUMN IF NOT EXISTS sync_status TEXT DEFAULT 'pending';

ALTER TABLE mvp_workflows 
ADD COLUMN IF NOT EXISTS last_sync_at TIMESTAMP WITH TIME ZONE;

-- Create performance indexes
CREATE INDEX IF NOT EXISTS idx_mvp_workflows_user_id 
ON mvp_workflows(user_id);

CREATE INDEX IF NOT EXISTS idx_mvp_workflows_n8n_workflow_id 
ON mvp_workflows(n8n_workflow_id);

CREATE INDEX IF NOT EXISTS idx_mvp_workflows_sync_status 
ON mvp_workflows(sync_status);

-- Add helpful comments
COMMENT ON COLUMN mvp_workflows.webhook_url 
IS 'The webhook URL generated by n8n for this workflow';

COMMENT ON COLUMN mvp_workflows.sync_status 
IS 'Synchronization status between Supabase and n8n';

COMMENT ON COLUMN mvp_workflows.last_sync_at 
IS 'Timestamp of the last synchronization';

-- Verify the changes
SELECT column_name, data_type, is_nullable, column_default
FROM information_schema.columns
WHERE table_name = 'mvp_workflows'
AND column_name IN ('webhook_url', 'sync_status', 'last_sync_at')
ORDER BY column_name;
```

### Step 3: Verify Results

After running, you should see:
- ✅ webhook_url column added
- ✅ sync_status column added  
- ✅ last_sync_at column added
- ✅ Performance indexes created

## 📊 Current Table Status

**Already Present** (verified by script):
- ✅ id
- ✅ user_id
- ✅ project_id
- ✅ name
- ✅ description
- ✅ n8n_workflow_id
- ✅ n8n_workflow_json
- ✅ original_prompt
- ✅ status
- ✅ version
- ✅ deployment_status
- ✅ deployment_url
- ✅ deployment_error
- ✅ last_deployed_at
- ✅ execution_count
- ✅ last_execution_at
- ✅ avg_execution_time_ms
- ✅ created_at
- ✅ updated_at

**Missing** (needs manual addition):
- ❌ webhook_url (CRITICAL)
- ❌ sync_status (for 2-way sync)
- ❌ last_sync_at (for 2-way sync)

## ⏱️ Time Required
- 5 minutes in Supabase SQL Editor

## 🎯 Impact
Once completed:
- ✅ Workflow creation will work
- ✅ Webhook URLs can be stored
- ✅ 2-way sync can be implemented
- ✅ Performance will be optimized with indexes